<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>Dashboard Kerja Borongan Arief</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
      * {
        box-sizing: border-box;
      }
      body {
        font-family:
          Segoe UI,
          sans-serif;
        background: #f4f6f8;
        padding: 12px;
      }
      .container {
        max-width: 1100px;
        margin: auto;
        background: #fff;
        padding: 16px;
        border-radius: 14px;
      }
      h1 {
        text-align: center;
        color: #1e3c72;
      }
      .form {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
      }
      .form input,
      .form select,
      .form button {
        padding: 12px;
        border-radius: 10px;
        border: 1px solid #ccc;
      }
      .form button {
        background: #1e3c72;
        color: #fff;
        font-weight: bold;
        cursor: pointer;
      }
      .table-wrapper {
        max-height: 400px;
        overflow: auto;
        margin-top: 15px;
        border: 1px solid #ccc;
        border-radius: 10px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        min-width: 520px;
      }
      thead th {
        position: sticky;
        top: 0;
        background: #1e3c72;
        color: #fff;
        padding: 8px;
        font-size: 13px;
      }
      td {
        padding: 6px;
        font-size: 12px;
        text-align: center;
        border-bottom: 1px solid #eee;
      }
      .tanggal-row {
        background: #eef3ff;
        font-weight: bold;
        text-align: left;
      }
      .total-harian {
        background: #fafafa;
        font-weight: bold;
      }
      tfoot {
        display: none;
        background: #e9f7ef;
        font-weight: bold;
      }
      .btn-del {
        background: #e74c3c;
        color: #fff;
        border: none;
        padding: 4px 8px;
        border-radius: 6px;
        cursor: pointer;
      }
      .btn {
        width: 100%;
        padding: 14px;
        margin-top: 12px;
        border: none;
        border-radius: 12px;
        font-weight: bold;
        cursor: pointer;
      }
      .btn-total {
        background: #0c7c59;
        color: #fff;
      }
      .btn-pdf {
        background: #34495e;
        color: #fff;
      }
      .btn-hapus {
        background: #c0392b;
        color: #fff;
      }

      @media (max-width: 900px) {
        .form {
          grid-template-columns: repeat(2, 1fr);
        }
      }
      @media (max-width: 600px) {
        .form {
          grid-template-columns: 1fr;
        }
      }

      #pdfArea {
        position: absolute;
        left: -9999px;
        width: 800px;
        background: #fff;
        padding: 20px;
      }
      #pdfArea th,
      #pdfArea td {
        border: 1px solid #000;
        padding: 6px;
        font-size: 12px;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <h1>üìä Dashboard Kerja Borongan</h1>

      <div class="form">
        <input type="date" id="tanggal" />
        <select id="ukuran">
          <option value="">Pilih Ukuran</option>
          <option data-harga="10.5">45‚Äì54 cm</option>
          <option data-harga="11.4">55‚Äì64 cm</option>
          <option data-harga="12.6">65‚Äì74 cm</option>
          <option data-harga="13.6">75‚Äì84 cm</option>
          <option data-harga="17">85‚Äì94 cm</option>
        </select>
        <input type="number" id="hasil" placeholder="Jumlah" />
        <button onclick="tambah()">Tambah</button>
      </div>

      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>Ukuran</th>
              <th>Harga</th>
              <th>Jumlah</th>
              <th>Total</th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody id="tabel"></tbody>
          <tfoot id="tfootTotal">
            <tr>
              <td colspan="3">TOTAL KESELURUHAN</td>
              <td id="totalKeseluruhan">Rp 0</td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </div>

      <button class="btn btn-total" onclick="hitungTotalKeseluruhan()">
        üßÆ TOTALKAN KESELURUHAN
      </button>

      <button class="btn btn-hapus" onclick="hapusSemua()">
        üóëÔ∏è HAPUS SEMUA DATA
      </button>

      <button class="btn btn-pdf" onclick="downloadPDF()">
        üì• DOWNLOAD PDF
      </button>
    </div>

    <!-- PDF AREA -->
    <div id="pdfArea">
      <h2 style="text-align: center">LAPORAN KERJA BORONGAN</h2>
      <table>
        <thead>
          <tr>
            <th>Ukuran</th>
            <th>Harga</th>
            <th>Jumlah</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody id="pdfTabel"></tbody>
        <tfoot>
          <tr>
            <td colspan="3">TOTAL KESELURUHAN</td>
            <td id="pdfTotal">Rp 0</td>
          </tr>
        </tfoot>
      </table>
    </div>

    <script>
      let data = JSON.parse(localStorage.getItem("borongan")) || [];
      const rupiah = (n) => "Rp " + Number(n).toLocaleString("id-ID");

      document.getElementById("tanggal").value = new Date()
        .toISOString()
        .slice(0, 10);

      function hariTanggal(t) {
        const h = [
          "Minggu",
          "Senin",
          "Selasa",
          "Rabu",
          "Kamis",
          "Jumat",
          "Sabtu",
        ];
        const b = [
          "Jan",
          "Feb",
          "Mar",
          "Apr",
          "Mei",
          "Jun",
          "Jul",
          "Agu",
          "Sep",
          "Okt",
          "Nov",
          "Des",
        ];
        const d = new Date(t);
        return `${h[d.getDay()]}, ${d.getDate()} ${b[d.getMonth()]} ${d.getFullYear()}`;
      }

      function tambah() {
        if (!ukuran.value || !hasil.value) {
          alert("Lengkapi data!");
          return;
        }

        const harga = Number(
          ukuran.options[ukuran.selectedIndex].dataset.harga,
        );
        const tanggalInput =
          tanggal.value || new Date().toISOString().slice(0, 10);
        const total = harga * hasil.value;

        data.push({
          tanggal: tanggalInput,
          ukuran: ukuran.value,
          harga,
          hasil: +hasil.value,
          total,
        });

        localStorage.setItem("borongan", JSON.stringify(data));
        ukuran.value = "";
        hasil.value = "";
        tfootTotal.style.display = "none";
        render();
      }

      function hapus(i) {
        data.splice(i, 1);
        localStorage.setItem("borongan", JSON.stringify(data));
        render();
      }

      function hapusSemua() {
        if (!data.length) return alert("Data sudah kosong!");
        if (confirm("Yakin ingin menghapus SEMUA data?")) {
          data = [];
          localStorage.removeItem("borongan");
          tabel.innerHTML = "";
          tfootTotal.style.display = "none";
        }
      }

      function render() {
        tabel.innerHTML = "";
        const group = {};
        data.forEach((d) => {
          if (!group[d.tanggal]) group[d.tanggal] = [];
          group[d.tanggal].push(d);
        });

        Object.keys(group)
          .sort()
          .forEach((tgl) => {
            let totalH = 0;
            tabel.innerHTML += `<tr class="tanggal-row"><td colspan="5">${hariTanggal(tgl)}</td></tr>`;
            group[tgl].forEach((d) => {
              totalH += d.total;
              tabel.innerHTML += `
              <tr>
                <td>${d.ukuran}</td>
                <td>${rupiah(d.harga)}</td>
                <td>${d.hasil}</td>
                <td>${rupiah(d.total)}</td>
                <td><button class="btn-del" onclick="hapus(${data.indexOf(d)})">Hapus</button></td>
              </tr>`;
            });
            tabel.innerHTML += `
            <tr class="total-harian">
              <td colspan="3">TOTAL PER HARI</td>
              <td>${rupiah(totalH)}</td>
              <td></td>
            </tr>`;
          });
      }

      function hitungTotalKeseluruhan() {
        totalKeseluruhan.innerText = rupiah(
          data.reduce((a, b) => a + b.total, 0),
        );
        tfootTotal.style.display = "table-footer-group";
      }

      async function downloadPDF() {
        if (!data.length) return alert("Data kosong!");

        pdfTabel.innerHTML = "";
        let grand = 0;
        const group = {};

        data.forEach((d) => {
          if (!group[d.tanggal]) group[d.tanggal] = [];
          group[d.tanggal].push(d);
        });

        Object.keys(group)
          .sort()
          .forEach((tgl) => {
            let harian = 0;
            pdfTabel.innerHTML += `<tr><td colspan="4"><b>${hariTanggal(tgl)}</b></td></tr>`;
            group[tgl].forEach((d) => {
              harian += d.total;
              grand += d.total;
              pdfTabel.innerHTML += `
              <tr>
                <td>${d.ukuran}</td>
                <td>${rupiah(d.harga)}</td>
                <td>${d.hasil}</td>
                <td>${rupiah(d.total)}</td>
              </tr>`;
            });
            pdfTabel.innerHTML += `
            <tr>
              <td colspan="3"><b>TOTAL PER HARI</b></td>
              <td><b>${rupiah(harian)}</b></td>
            </tr>`;
          });

        pdfTotal.innerText = rupiah(grand);

        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF();
        const canvas = await html2canvas(pdfArea, { scale: 2 });
        const imgWidth = 190;
        const imgHeight = (canvas.height * imgWidth) / canvas.width;
        pdf.addImage(
          canvas.toDataURL("image/png"),
          "PNG",
          10,
          10,
          imgWidth,
          imgHeight,
        );
        pdf.save("Laporan_Borongan.pdf");
      }

      render();
    </script>
  </body>
</html>
