<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>Dashboard Kerja Borongan</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
      body {
        font-family: "Segoe UI", sans-serif;
        background: linear-gradient(135deg, #1e3c72, #2a5298);
        margin: 0;
        padding: 20px;
      }
      .container {
        max-width: 1200px;
        margin: auto;
        background: #fff;
        padding: 20px;
        border-radius: 16px;
      }
      h1,
      h2 {
        text-align: center;
        color: #1e3c72;
      }

      /* dashboard */
      .dashboard {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 15px;
      }
      .card {
        background: linear-gradient(135deg, #0c7c59, #16a085);
        color: #fff;
        padding: 15px;
        border-radius: 14px;
        text-align: center;
      }
      .card span {
        font-size: 24px;
        font-weight: 700;
        display: block;
        margin-top: 5px;
      }

      /* form */
      .form {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 10px;
        margin-top: 20px;
      }
      input,
      select,
      button {
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #ccc;
        width: 100%;
        box-sizing: border-box;
      }
      button {
        cursor: pointer;
      }
      .btn-add {
        background: #1e3c72;
        color: #fff;
      }
      .btn-del {
        background: #e74c3c;
        color: #fff;
      }
      .btn-pdf {
        background: #0c7c59;
        color: #fff;
        width: 100%;
        margin-top: 15px;
      }

      /* table */
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }
      th {
        background: #1e3c72;
        color: #fff;
        padding: 10px;
        font-size: 14px;
      }
      td {
        padding: 8px;
        border-bottom: 1px solid #eee;
        font-size: 14px;
        text-align: center;
        word-break: break-word;
      }

      /* summary */
      .summary {
        margin-top: 20px;
        background: linear-gradient(135deg, #1e3c72, #2a5298);
        color: #fff;
        padding: 15px;
        border-radius: 12px;
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
      }
      .summary span {
        font-size: 22px;
        font-weight: 700;
      }

      /* motivasi */
      .motivasi {
        margin-top: 15px;
        padding: 14px;
        border-radius: 10px;
        font-weight: 600;
        text-align: center;
        display: none;
      }
      .motivasi.sukses {
        background: #e8fff4;
        color: #0c7c59;
        border: 2px solid #0c7c59;
      }
      .motivasi.warning {
        background: #fff0f0;
        color: #c0392b;
        border: 2px solid #c0392b;
      }

      canvas {
        margin-top: 20px;
        width: 100% !important;
        height: auto !important;
      }

      /* responsive */
      @media (max-width: 768px) {
        th,
        td {
          font-size: 12px;
          padding: 6px;
        }
        .card span {
          font-size: 20px;
        }
        .summary span {
          font-size: 18px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container" id="areaPDF">
      <h1>üìä Dashboard Kerja Borongan</h1>

      <div class="dashboard">
        <div class="card">
          <h4>Total Pendapatan</h4>
          <span id="dTotal">Rp 0</span>
        </div>
        <div class="card">
          <h4>Hari Ini</h4>
          <span id="dHari">Rp 0</span>
        </div>
        <div class="card">
          <h4>Bulan Ini</h4>
          <span id="dBulan">Rp 0</span>
        </div>
        <div class="card">
          <h4>Total Data</h4>
          <span id="dData">0</span>
        </div>
      </div>

      <div class="form" id="formInput">
        <input id="nama" placeholder="Nama" />
        <select id="ukuran">
          <option value="">Ukuran</option>
          <option data-harga="10.5">45‚Äì54 cm</option>
          <option data-harga="11.4">55‚Äì64 cm</option>
          <option data-harga="12.6">65‚Äì74 cm</option>
          <option data-harga="13.6">75‚Äì84 cm</option>
          <option data-harga="17">85‚Äì94 cm</option>
        </select>
        <input type="number" id="hasil" placeholder="Jumlah" />
        <button class="btn-add" onclick="tambah()">Tambah</button>
      </div>

      <table>
        <thead>
          <tr>
            <th>Tanggal</th>
            <th>Nama</th>
            <th>Ukuran</th>
            <th>Harga</th>
            <th>Jumlah</th>
            <th>Total</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="tabel"></tbody>
      </table>

      <div class="summary">
        <h3>Total Keseluruhan</h3>
        <span id="grand">Rp 0</span>
      </div>

      <div id="motivasiHarian" class="motivasi"></div>
      <div id="motivasiBulanan" class="motivasi"></div>

      <h2>üìà Grafik Pendapatan</h2>
      <canvas id="grafikHarian"></canvas>
      <canvas id="grafikBulanan"></canvas>
    </div>

    <button class="btn-pdf" onclick="downloadPDF()">üì• Download PDF</button>

    <script>
      let data = JSON.parse(localStorage.getItem("borongan")) || [];
      let chHarian, chBulanan;
      const rupiah = (n) => "Rp " + Number(n).toLocaleString("id-ID");

      function hariTanggal(date) {
        const hari = [
          "Minggu",
          "Senin",
          "Selasa",
          "Rabu",
          "Kamis",
          "Jumat",
          "Sabtu",
        ];
        const bulan = [
          "Jan",
          "Feb",
          "Mar",
          "Apr",
          "Mei",
          "Jun",
          "Jul",
          "Agu",
          "Sep",
          "Okt",
          "Nov",
          "Des",
        ];
        const d = new Date(date);
        return `${hari[d.getDay()]}, ${d.getDate()} ${bulan[d.getMonth()]} ${d.getFullYear()}`;
      }

      function tambah() {
        if (!nama.value || !ukuran.value || !hasil.value) {
          alert("Lengkapi data");
          return;
        }
        const h = Number(ukuran.options[ukuran.selectedIndex].dataset.harga);
        const t = h * Number(hasil.value);
        const now = new Date();
        const tanggal = now.toISOString().slice(0, 10);

        data.push({
          nama: nama.value,
          tanggal: tanggal,
          ukuran: ukuran.value,
          harga: h,
          hasil: Number(hasil.value),
          total: t,
        });

        localStorage.setItem("borongan", JSON.stringify(data));
        render();

        nama.value = "";
        ukuran.value = "";
        hasil.value = "";
      }

      function hapus(i) {
        data.splice(i, 1);
        localStorage.setItem("borongan", JSON.stringify(data));
        render();
      }

      function render() {
        tabel.innerHTML = "";
        let gt = 0,
          hari = 0,
          bulan = 0;
        const today = new Date().toISOString().slice(0, 10);
        const bln = today.slice(0, 7);

        data.forEach((d, i) => {
          gt += d.total;
          if (d.tanggal === today) hari += d.total;
          if (d.tanggal.slice(0, 7) === bln) bulan += d.total;

          tabel.innerHTML += `
      <tr>
        <td>${hariTanggal(d.tanggal)}</td>
        <td>${d.nama}</td>
        <td>${d.ukuran}</td>
        <td>${rupiah(d.harga)}</td>
        <td>${d.hasil}</td>
        <td>${rupiah(d.total)}</td>
        <td><button class="btn-del" onclick="hapus(${i})">Hapus</button></td>
      </tr>
    `;
        });

        grand.innerText = dTotal.innerText = rupiah(gt);
        dHari.innerText = rupiah(hari);
        dBulan.innerText = rupiah(bulan);
        dData.innerText = data.length;

        grafik();
        cekMotivasi();
      }

      function grafik() {
        const h = {},
          b = {};
        data.forEach((d) => {
          h[d.tanggal] = (h[d.tanggal] || 0) + d.total;
          b[d.tanggal.slice(0, 7)] = (b[d.tanggal.slice(0, 7)] || 0) + d.total;
        });

        if (chHarian) chHarian.destroy();
        if (chBulanan) chBulanan.destroy();

        chHarian = new Chart(grafikHarian, {
          type: "bar",
          data: {
            labels: Object.keys(h).map((d) => hariTanggal(d)),
            datasets: [
              {
                label: "Harian",
                data: Object.values(h),
                backgroundColor: "#1e3c72",
              },
            ],
          },
        });
        chBulanan = new Chart(grafikBulanan, {
          type: "line",
          data: {
            labels: Object.keys(b),
            datasets: [
              {
                label: "Bulanan",
                data: Object.values(b),
                borderColor: "#0c7c59",
                fill: true,
                tension: 0.4,
              },
            ],
          },
        });
      }

      function cekMotivasi() {
        const mapH = {},
          mapB = {};
        data.forEach((d) => {
          mapH[d.tanggal] = (mapH[d.tanggal] || 0) + d.total;
          mapB[d.tanggal.slice(0, 7)] =
            (mapB[d.tanggal.slice(0, 7)] || 0) + d.total;
        });

        const kH = Object.keys(mapH).sort();
        if (kH.length >= 2) {
          const el = document.getElementById("motivasiHarian");
          el.style.display = "block";
          if (mapH[kH.at(-1)] > mapH[kH.at(-2)]) {
            el.className = "motivasi sukses";
            el.innerHTML =
              "üî• Kinerja harian meningkat! Pertahankan semangat kerja üí™";
          } else {
            el.className = "motivasi warning";
            el.innerHTML =
              "‚ö†Ô∏è Kinerja harian menurun. Evaluasi dan bangkit besok üí™";
          }
        }

        const kB = Object.keys(mapB).sort();
        if (kB.length >= 2) {
          const el = document.getElementById("motivasiBulanan");
          el.style.display = "block";
          if (mapB[kB.at(-1)] > mapB[kB.at(-2)]) {
            el.className = "motivasi sukses";
            el.innerHTML =
              "üèÜ Bulan ini lebih baik dari bulan lalu! Kerja kerasmu terbukti üëè";
          } else {
            el.className = "motivasi warning";
            el.innerHTML =
              "‚ö†Ô∏è Pendapatan bulanan menurun. Tetapkan target baru üöÄ";
          }
        }
      }

      /* PDF */
      async function downloadPDF() {
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF("p", "mm", "a4");
        const canvas = await html2canvas(document.getElementById("areaPDF"), {
          scale: 2,
        });
        const img = canvas.toDataURL("image/png");
        const w = 210,
          h = (canvas.height * w) / canvas.width;
        pdf.addImage(img, "PNG", 0, 0, w, h);
        pdf.save("Laporan_Kerja_Borongan.pdf");
      }

      render();
    </script>
  </body>
</html>
